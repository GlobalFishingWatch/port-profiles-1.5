---
title: "Port_Program_Quarterly_Q2_2025"
author: "Max Schofield"
date: "2025-04-07"
output: html_document
---

```{=html}
<style>
body {
text-align: left}
</style>
```

# Setup 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load packages, echo=F, warning=F, include=FALSE}
load_or_install_libraries <- function(x){
  for( i in x ){
    #  require returns TRUE invisibly if it was able to load package
    if( ! require( i , character.only = TRUE ) ){
      #  If package was not able to be loaded then re-install
      install.packages( i , dependencies = TRUE )
      #  Load package after installing
      require( i , character.only = TRUE )
    }
  }
}

#  Then try/install packages...
load_or_install_libraries( c("tidyverse" , "bigrquery" ,"devtools", "DBI","glue", "lubridate", "here", "sf", "extrafont", "patchwork", "terra", "rgeos", "ggspatial", "ggrepel", "tibble") )

# get fishwatch r independently 
if (!require("fishwatchr")) {devtools::install_github("GlobalFishingWatch/fishwatchr")}
library(fishwatchr)
```

```{r connection to BQ, echo=F, warning=F, include=FALSE}
con <- DBI::dbConnect(drv = bigrquery::bigquery(), 
                      project = "world-fishing-827", 
                      use_legacy_sql = FALSE)
```

# Cote Divore  

# set parameters for analysis 

```{r set date and port parameters, echo=F, warning=F, include=FALSE}
start_date <- "'2025-04-01 00:00:00 UTC'" 
end_date <- "'2025-06-30 23:59:59 UTC'"
year <- 2025

country_iso3 <- "'CIV'"
port_name <- "'ABIDJAN'"

prev_visit_search_date <- "'2022-01-01 00:00:00 UTC'" 

# file names
month <- 'Q2'
country <- 'CIV'

# when to look for previous visits
prev_visit_search_date <- "'2020-01-01 00:00:00 UTC'" 


# potential MMSIs to force in 
missing_ssvids <- ''

# create a temp table for query 
temp_table_voyages <- '`world-fishing-827.scratch_max.civ_q2_25_all_voyages_temp`'
```


# run voyage query
```{r voyages all, echo=F, warning=F, include=FALSE}

voyages_q <- readr::read_file(here::here("queries","proactive", "recent_country_activity_c2_v4.sql"))

fishwatchr::gfw_query(query = glue::glue(voyages_q, 
                                                    start_date = start_date,
                                                    end_date = end_date,
                                                    year = year,
                                                    missing_ssvids = missing_ssvids,
                                                    temp_table = temp_table_voyages,
                                                    port_iso = country_iso3,
                                                    prev_visit_search_date = prev_visit_search_date),
                                 run_query = TRUE,
                                 con = con)

```

```{r voyages ais coverage, echo=F, warning=F, include=FALSE}

ais_cov_q <- readr::read_file(here::here("queries","proactive", "voyage_ais_coverage_no_port.sql"))

voyages_with_coverage <- fishwatchr::gfw_query(query = glue::glue(ais_cov_q, 
                                                    temp_table = temp_table_voyages,
                                                    start_date = start_date,
                                                    end_date = end_date),
                                 run_query = TRUE,
                                 con = con)$data

```

```{r gear type corrections from TMT data, echo=F, warning=F, include=FALSE}
# import QA vessel list from TMT for identity corrections 
abj_ves <- read.csv(here::here("data","TMT_qa_vessel_list", "Abidjan_08Jul2025.csv"), header=T) 

# reset ssvid to characher
abj_ves$ssvid <- as.character(abj_ves$ssvid)

# Join update data to main data
merged_df <- left_join(voyages_with_coverage, abj_ves, by = "ssvid", suffix = c("", "_tmt"))

# update columns when they aren't NA 
# map columns to update
column_mapping <- list(
  vessel_flag_best = "CurrentFlag_tmt",
  vessel_class_best  = "VesselType_tmt",
  geartype_best = "GearType_tmt"            
)

# Replace values in gfw_df with tmt_df values (if not NA)
for (main_col in names(column_mapping)) {
  update_col <- column_mapping[[main_col]]
  if (update_col %in% names(merged_df)) {
    merged_df[[main_col]] <- ifelse(!is.na(merged_df[[update_col]]), 
                                     merged_df[[update_col]], 
                                     merged_df[[main_col]])
    # Optionally remove the update column after replacement
    merged_df[[update_col]] <- NULL
  }
}

```


```{r add gfw hyperlink for voyage, echo=F, warning=F, include=FALSE}

# base componenets for VV string to accompany port profiles 
base_string_p1 <- 'https://globalfishingwatch.org/map/vessel/'
base_string_p2 <- '?&start='
base_string_p3 <- '&end='
start_date_url <- '2025-01-01'
end_date_url <- '2025-3-31'

#format(voyages_with_coverage$trip_start, format='%Y-%m-%d')

# paste string components together using vessel id, trip start and trip end from data 
voyages_url <- bind_cols(merged_df, 
                         vv_url = paste('=HYPERLINK("',
                          base_string_p1,
                          voyages_with_coverage$vessel_id, 
                          base_string_p2, 
                          as.Date(format(voyages_with_coverage$trip_start, format='%Y-%m-%d'))-2, 
                          base_string_p3, 
                          as.Date(format(voyages_with_coverage$trip_end, format='%Y-%m-%d'))+2,
                          '")', sep=''))

# write.csv(voyages_url, here::here("data","proactive", paste('GHA_Q2_test','-', Sys.Date(),".csv", sep='')), row.names=F)

```

```{r add in port information for CIV using anchorage stops}
anchorages <- fishwatchr::gfw_query(query = c("SELECT s2id, lat, lon, label, sublabel FROM `world-fishing-827.anchorages.named_anchorages_v20240117` WHERE iso3 = 'CIV'"),
                       run_query = TRUE,
                       con = con)$data

# write.csv(anchorages, here::here("data","2025_q1", paste('Abidjan_anchorages','_', Sys.Date(),".csv", sep='')), row.names=F)

table(anchorages$sublabel)

# s2ids for port features of interest 
vridi <- filter(anchorages, sublabel == 'ABIDJAN VRIDI')$s2id
lagoon <- filter(anchorages, sublabel == 'ABIDJAN LAGOON')$s2id
cargo <- filter(anchorages, sublabel == 'ABIDJAN TREICHVILLE CARGO')$s2id
fishing <- filter(anchorages, sublabel == 'ABIDJAN TREICHVILLE FISHING')$s2id
offshore <- filter(anchorages, sublabel %in% c('ABIDJAN OFFSHORE', 'PORT BOUET', 'ABIDJAN PORT BOUET OFFSHORE'))$s2id

port_stops <- voyages_url %>%
  rowwise() %>%
  mutate(abj_lagoon = any(str_trim(str_split(stop_anchorage_ids, ",")[[1]]) %in% lagoon),
         abj_vridi = any(str_trim(str_split(stop_anchorage_ids, ",")[[1]]) %in% vridi),
         abj_cargo = any(str_trim(str_split(stop_anchorage_ids, ",")[[1]]) %in% cargo),
         abj_fishing = any(str_trim(str_split(stop_anchorage_ids, ",")[[1]]) %in% fishing),
         abj_offshore = any(str_trim(str_split(stop_anchorage_ids, ",")[[1]]) %in% offshore))

```


```{r format the data to TMT format, echo=F, warning=F, include=FALSE}
# change colnames to be sensible for an externally shared document 
voyages_reformat <- dplyr::select(port_stops, vessel_name=shipname, MMSI=ssvid,
   Flag=vessel_flag_best, AIS_Flag= mmsi_flag, imo, vessel_class_cat=vessel_class_initial, vessel_class_confidence = class_confidence_initial, vessel_class=vessel_class_best,
   vessel_type=geartype_best,  previous_port_country = start_port_iso3,
   previous_port = start_port_label, trip_start, trip_start_confidence, trip_end, trip_end_confidence, trip_duration_days,
   end_port = end_port_label, at_dock=dock, abj_lagoon, abj_vridi, abj_cargo, abj_fishing, abj_offshore, fishing=num_fishing, fishing_hours, fishing_eez=eezs, fishing_hs =high_seas, fishing_rfmos = rfmos, encounter= 1, num_encounters=num_encounters, loitering=1, num_loitering, percent_ais_voyage=percent_ais_voyage, vv_url)
   #gaps=1, num_gaps, total_gap_hours)

# overwrite encounters T/F
voyages_reformat$encounter <- ifelse(is.na(voyages_reformat$num_encounters), FALSE, TRUE)

# overwrite loitering T/F
voyages_reformat$loitering <- ifelse(is.na(voyages_reformat$num_loitering), FALSE, TRUE)

# overwrite fishing T/F
voyages_reformat$fishing <- ifelse(is.na(voyages_reformat$fishing), FALSE, TRUE)

# overwrite fishing_hs T/F
voyages_reformat$fishing_hs <- ifelse(is.na(voyages_reformat$fishing_hs), FALSE, TRUE)

write.csv(voyages_reformat, here::here("data","q2_2025", paste(country,'_', month,'_', year,'_', Sys.Date(),".csv", sep='')), row.names=F)
```



# Ghana 

## set parameters for analysis 

```{r set date and port parameters, echo=F, warning=F, include=FALSE}
start_date <- "'2025-04-01 00:00:00 UTC'" 
end_date <- "'2025-06-30 23:59:59 UTC'"
year <- 2025

prev_visit_search_date <- "'2022-01-01 00:00:00 UTC'" 

country_iso3 <- "'GHA'"
# port_name <- "'ABIDJAN'"

# file names
month <- 'Q2'
country <- 'GHA'

# potential MMSIs to force in 
missing_ssvids <- '""'

# create a temp table for query 
temp_table_voyages <- '`world-fishing-827.scratch_joef.gha_q2_25_all_voyages_temp`'
```

## run voyage query
```{r voyages all, echo=F, warning=F, include=FALSE}

voyages_q <- readr::read_file(here::here("queries","proactive", "recent_country_activity_c2_v4.sql"))

fishwatchr::gfw_query(query = glue::glue(voyages_q, 
                                                    start_date = start_date,
                                                    end_date = end_date,
                                                    year = year,
                                                    missing_ssvids = missing_ssvids,
                                                    start_year = start_year,
                                                    end_year = end_year,
                                                    temp_table = temp_table_voyages,
                                                    port_iso = country_iso3),
                                 run_query = TRUE,
                                 con = con)

```
## run AIS query
```{r voyages ais coverage, echo=F, warning=F, include=FALSE}

ais_cov_q <- readr::read_file(here::here("queries","proactive", "voyage_ais_coverage_no_port.sql"))

voyages_with_coverage <- fishwatchr::gfw_query(query = glue::glue(ais_cov_q, 
                                                    temp_table = temp_table_voyages,
                                                    start_date = start_date,
                                                    end_date = end_date),
                                 run_query = TRUE,
                                 con = con)$data

```
## add urls
```{r add gfw hyperlink for voyage, echo=F, warning=F, include=FALSE}

# base componenets for VV string to accompany port profiles 
base_string_p1 <- 'https://globalfishingwatch.org/map/vessel/'
base_string_p2 <- '?&start='
base_string_p3 <- '&end='
start_date_url <- '2025-01-01'
end_date_url <- '2025-3-31'

#format(voyages_with_coverage$trip_start, format='%Y-%m-%d')

# paste string components together using vessel id, trip start and trip end from data 
voyages_url <- bind_cols(voyages_with_coverage, 
                         vv_url = paste('=HYPERLINK("',
                          base_string_p1,
                          voyages_with_coverage$vessel_id, 
                          base_string_p2, 
                          as.Date(format(voyages_with_coverage$trip_start, format='%Y-%m-%d'))-2, 
                          base_string_p3, 
                          as.Date(format(voyages_with_coverage$trip_end, format='%Y-%m-%d'))+2,
                          '")', sep=''))

```

## add port info
```{r add in port information for Ghana using anchorage stops}
# s2ids for port features of interest 
general_port <- c("102078b1", "102078bb", "102078a5", "102078a3", "102078bd", "10207899")
fuel <- c("102078bf")
fishing_port <- c("102078b7", "102078c7", "102078b9")
takoradi_gen <- c("0fe770a9", "0fe770a7", "0fe770a1", "0fe770a3", "0fe770a5", "0fe770af")

# add logic column to indicate presence at each location of interest 
voyages_url$tema_general <- sapply(voyages_url$stop_anchorage_ids, function(x) {
  any(strsplit(x, ",\\s*")[[1]] %in% general_port)
})

voyages_url$tema_fuel <- sapply(voyages_url$stop_anchorage_ids, function(x) {
  any(strsplit(x, ",\\s*")[[1]] %in% fuel)
})

voyages_url$tema_fishing <- sapply(voyages_url$stop_anchorage_ids, function(x) {
  any(strsplit(x, ",\\s*")[[1]] %in% fishing_port)
})

voyages_url$takoradi_general <- sapply(voyages_url$stop_anchorage_ids, function(x) {
  any(strsplit(x, ",\\s*")[[1]] %in% takoradi_gen)
})

```

```{r format the data to TMT format, echo=F, warning=F, include=FALSE}
# change colnames to be sensible for an externally shared document 
voyages_reformat <- dplyr::select(voyages_url, vessel_name=shipname, MMSI=ssvid,
   Flag=vessel_flag_best, AIS_Flag= mmsi_flag, imo, vessel_class_cat=vessel_class_initial, vessel_class_confidence = class_confidence_initial, vessel_class=vessel_class_best,
   vessel_type=geartype_best,  previous_port_country = start_port_iso3,
   previous_port = start_port_label, trip_start, trip_start_confidence, trip_end, trip_end_confidence, trip_duration_days,
   end_port = end_port_label, tema_general, tema_fuel, tema_fishing, takoradi_general, num_fishing, fishing_hours, fishing_eez=eezs, fishing_hs =high_seas, fishing_rfmos = rfmos, encounter, num_encounters, loitering, num_loitering, AISdisabling, num_AISdisabling, percent_ais_voyage=percent_ais_voyage, vv_url) #, total_gap_hours)

# overwrite fishing_hs T/F
voyages_reformat$fishing_hs <- ifelse(is.na(voyages_reformat$fishing_hs), FALSE, TRUE)

write.csv(voyages_reformat, here::here("data", paste(country,'_', month,'_', year,'_', Sys.Date(),".csv", sep='')), row.names=F)
```

# Senegal  

# set parameters for analysis 

```{r set date and port parameters, echo=F, warning=F, include=FALSE}
start_date <- "'2025-01-01 00:00:00 UTC'" 
end_date <- "'2025-03-31 23:59:59 UTC'"
year <- 2025

country_iso3 <- "'SEN'"
port_name <- "'DAKAR'"

# file names
month <- 'Q1'
country <- 'SEN'


missing_ssvids <- '"630123009", "306881000", "412209113", "663250000"'

# create a temp table for query 
temp_table_voyages <- '`world-fishing-827.scratch_max.sen_q1_25_all_voyages_temp`'
```

```{r voyages all, echo=F, warning=F, include=FALSE}

voyages_q <- readr::read_file(here::here("queries","proactive", "recent_country_activity_c2_v4.sql"))

fishwatchr::gfw_query(query = glue::glue(voyages_q, 
                                                    start_date = start_date,
                                                    end_date = end_date,
                                                    year = year,
                                                    start_year = start_year,
                                                    end_year = end_year,
                                                    temp_table = temp_table_voyages,
                                                    missing_ssvids = missing_ssvids,
                                                    port_iso = country_iso3),
                                 run_query = TRUE,
                                 con = con)

```

```{r voyages ais coverage, echo=F, warning=F, include=FALSE}

ais_cov_q <- readr::read_file(here::here("queries","proactive", "voyage_ais_coverage_no_port.sql"))

voyages_with_coverage <- fishwatchr::gfw_query(query = glue::glue(ais_cov_q, 
                                                    temp_table = temp_table_voyages,
                                                    start_date = start_date,
                                                    end_date = end_date),
                                 run_query = TRUE,
                                 con = con)$data

```

```{r add gfw hyperlink for voyage, echo=F, warning=F, include=FALSE}

# base componenets for VV string to accompany port profiles 
base_string_p1 <- 'https://globalfishingwatch.org/map/vessel/'
base_string_p2 <- '?&start='
base_string_p3 <- '&end='
start_date_url <- '2025-01-01'
end_date_url <- '2025-3-31'

#format(voyages_with_coverage$trip_start, format='%Y-%m-%d')

# paste string components together using vessel id, trip start and trip end from data 
voyages_url <- bind_cols(voyages_with_coverage, 
                         vv_url = paste('=HYPERLINK("',
                          base_string_p1,
                          voyages_with_coverage$vessel_id, 
                          base_string_p2, 
                          as.Date(format(voyages_with_coverage$trip_start, format='%Y-%m-%d'))-2, 
                          base_string_p3, 
                          as.Date(format(voyages_with_coverage$trip_end, format='%Y-%m-%d'))+2,
                          '")', sep=''))

```


```{r add in port information for SEN using anchorage stops}
anchorages <- fishwatchr::gfw_query(query = c("SELECT s2id, label, sublabel FROM `world-fishing-827.anchorages.named_anchorages_v20240117` WHERE iso3 = 'SEN'"),
                       run_query = TRUE,
                       con = con)$data

table(anchorages$sublabel)

# s2ids for port features of interest 
general <- c("0ec17253", "0ec173ad", "0ec173b3", "0ec173b1", "0ec173af", "0ec173a9")
fishing <- c("0ec17301", "0ec173ab", "0ec172ff", "0ec17255")

port_stops <- voyages_url %>%
  rowwise() %>%
  mutate(dak_general = any(str_trim(str_split(stop_anchorage_ids, ",")[[1]]) %in% general),
         dak_fishing = any(str_trim(str_split(stop_anchorage_ids, ",")[[1]]) %in% fishing))

```


```{r format the data to TMT format, echo=F, warning=F, include=FALSE}
# change colnames to be sensible for an externally shared document 
voyages_reformat <- dplyr::select(port_stops, vessel_name=shipname, MMSI=ssvid,
   Flag=vessel_flag_best, flag_ais=mmsi_flag, imo, vessel_class_cat=vessel_class_initial, vessel_class_confidence = class_confidence_initial, vessel_class=vessel_class_best,
   vessel_type=geartype_best,  previous_port_country = start_port_iso3,
   previous_port = start_port_label, trip_start, trip_start_confidence, trip_end, trip_end_confidence, trip_duration_days,
   end_port = end_port_label, dak_general, dak_fishing, fishing=num_fishing, fishing_hours, fishing_eez=eezs, fishing_hs =high_seas, fishing_rfmos = rfmos, encounter= 1, num_encounters=num_encounters, loitering=1, num_loitering, percent_ais_voyage=percent_ais_voyage, vv_url)
   #gaps=1, num_gaps, total_gap_hours)

# overwrite encounters T/F
voyages_reformat$encounter <- ifelse(is.na(voyages_reformat$num_encounters), FALSE, TRUE)

# overwrite loitering T/F
voyages_reformat$loitering <- ifelse(is.na(voyages_reformat$num_loitering), FALSE, TRUE)

# overwrite fishing T/F
voyages_reformat$fishing <- ifelse(is.na(voyages_reformat$fishing), FALSE, TRUE)

# overwrite fishing_hs T/F
voyages_reformat$fishing_hs <- ifelse(is.na(voyages_reformat$fishing_hs), FALSE, TRUE)

write.csv(voyages_reformat, here::here("data","2025_q1", paste(country,'_', month,'_', year,'_', Sys.Date(),".csv", sep='')), row.names=F)
```


# Kenya  

# set parameters for analysis 

```{r set date and port parameters, echo=F, warning=F, include=FALSE}
start_date <- "'2025-01-01 00:00:00 UTC'" 
end_date <- "'2025-03-31 23:59:59 UTC'"
year <- 2025

country_iso3 <- "'KEN'"
#port_name <- "'MOMBASA'"

# file names
month <- 'Q1'
country <- 'KEN'

# create a temp table for query 
temp_table_voyages <- '`world-fishing-827.scratch_max.ken_q1_25_all_voyages_temp`'
```

```{r voyages all, echo=F, warning=F, include=FALSE}

voyages_q <- readr::read_file(here::here("queries","proactive", "recent_country_activity_c2_v4.sql"))

fishwatchr::gfw_query(query = glue::glue(voyages_q, 
                                                    start_date = start_date,
                                                    end_date = end_date,
                                                    year = year,
                                                    start_year = start_year,
                                                    end_year = end_year,
                                                    temp_table = temp_table_voyages,
                                                    port_iso = country_iso3),
                                 run_query = TRUE,
                                 con = con)

```

```{r voyages ais coverage, echo=F, warning=F, include=FALSE}

ais_cov_q <- readr::read_file(here::here("queries","proactive", "voyage_ais_coverage_no_port.sql"))

voyages_with_coverage <- fishwatchr::gfw_query(query = glue::glue(ais_cov_q, 
                                                    temp_table = temp_table_voyages,
                                                    start_date = start_date,
                                                    end_date = end_date),
                                 run_query = TRUE,
                                 con = con)$data

```

```{r add gfw hyperlink for voyage, echo=F, warning=F, include=FALSE}

# base componenets for VV string to accompany port profiles 
base_string_p1 <- 'https://globalfishingwatch.org/map/vessel/'
base_string_p2 <- '?&start='
base_string_p3 <- '&end='
start_date_url <- '2025-01-01'
end_date_url <- '2025-3-31'

#format(voyages_with_coverage$trip_start, format='%Y-%m-%d')

# paste string components together using vessel id, trip start and trip end from data 
voyages_url <- bind_cols(voyages_with_coverage, 
                         vv_url = paste('=HYPERLINK("',
                          base_string_p1,
                          voyages_with_coverage$vessel_id, 
                          base_string_p2, 
                          as.Date(format(voyages_with_coverage$trip_start, format='%Y-%m-%d'))-2, 
                          base_string_p3, 
                          as.Date(format(voyages_with_coverage$trip_end, format='%Y-%m-%d'))+2,
                          '")', sep=''))

```



```{r add in port information for SEN using anchorage stops}
anchorages <- fishwatchr::gfw_query(query = c("SELECT s2id, lat, lon, label, sublabel FROM `world-fishing-827.anchorages.named_anchorages_v20240117` WHERE iso3 = 'KEN'"),
                       run_query = TRUE,
                       con = con)$data

table(anchorages$sublabel)

# write.csv(anchorages, here::here("data","2025_q1", paste(country,'anchorages-', Sys.Date(),".csv", sep='')), row.names=F)


# s2ids for port features of interest 
general <- c("18401349", "18401347",  "18406d2b", "18406d31", 
             "18406d13", "18406d6b", "18406d15", "18406d2d", "18406d41", "18406d47", 
             "18406d37", "18406d33", "18406d49", "18406d0d")
fishing <- c("18401331", "1840132d")
dry_dock <- c("18401337","18401339")
fish_harbour <- c("18406cd3", "18406ccd" , "18406ccf",  "18406cd1")
harbor <- c("18406d0f", "18406da9", "18406d07", "18406daf", "18406d09", "18406da7",
            "18406cd7", "18406d2f", "18406d29")


port_stops <- voyages_url %>%
  rowwise() %>%
  mutate(mom_general = any(str_trim(str_split(stop_anchorage_ids, ",")[[1]]) %in% general),
         mom_fishing = any(str_trim(str_split(stop_anchorage_ids, ",")[[1]]) %in% fishing),
         mom_fishing_harbor = any(str_trim(str_split(stop_anchorage_ids, ",")[[1]]) %in% fish_harbour),
         mom_drydock = any(str_trim(str_split(stop_anchorage_ids, ",")[[1]]) %in% dry_dock),
         mom_harbor = any(str_trim(str_split(stop_anchorage_ids, ",")[[1]]) %in% harbor))

```


```{r format the data to TMT format, echo=F, warning=F, include=FALSE}
# change colnames to be sensible for an externally shared document 
voyages_reformat <- dplyr::select(port_stops, vessel_name=shipname, MMSI=ssvid,
   Flag=vessel_flag_best, imo, vessel_class_cat=vessel_class_initial, vessel_class_confidence = class_confidence_initial, vessel_class=vessel_class_best,
   vessel_type=geartype_best,  previous_port_country = start_port_iso3,
   previous_port = start_port_label, trip_start, trip_start_confidence, trip_end, trip_end_confidence, trip_duration_days,
   end_port = end_port_label, mom_general, mom_fishing, mom_fishing_harbor, mom_harbor, mom_drydock,  fishing=num_fishing, fishing_hours, fishing_eez=eezs, fishing_hs =high_seas, fishing_rfmos = rfmos, encounter= 1, num_encounters=num_encounters, loitering=1, num_loitering, percent_ais_voyage=percent_ais_voyage, vv_url)
   #gaps=1, num_gaps, total_gap_hours)

# overwrite encounters T/F
voyages_reformat$encounter <- ifelse(is.na(voyages_reformat$num_encounters), FALSE, TRUE)

# overwrite loitering T/F
voyages_reformat$loitering <- ifelse(is.na(voyages_reformat$num_loitering), FALSE, TRUE)

# overwrite fishing T/F
voyages_reformat$fishing <- ifelse(is.na(voyages_reformat$fishing), FALSE, TRUE)

# overwrite fishing_hs T/F
voyages_reformat$fishing_hs <- ifelse(is.na(voyages_reformat$fishing_hs), FALSE, TRUE)

# write.csv(voyages_reformat, here::here("data","2025_q1", paste(country,'_', month,'_', year,'_', Sys.Date(),".csv", sep='')), row.names=F)
```


